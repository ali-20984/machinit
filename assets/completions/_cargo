#!/usr/bin/env bash
# Curated cargo completion: common subcommands and options
#compdef cargo

local -a commands
commands=(
  'build:Compile the current package'
  'check:Check the package without producing artifacts'
  'clean:Remove artifacts'
  'run:Run a binary or example of the local package'
  'test:Run tests'
  'bench:Run benchmarks'
  'doc:Build documentation'
  'fmt:Format code (cargo fmt)'
  'clippy:Run lints (cargo clippy)'
  'new:Create a new package'
  'init:Initialize a package in an existing directory'
  'install:Install a binary'
  'update:Update dependencies'
  'search:Search registry for crates'
  'publish:Publish package to registry'
  'login:Login to registry (if supported)'
  'metadata:Output package metadata as JSON'
  'help:Show help'
)

_describe 'cargo subcommand' commands && return 0

# Generic fallback: files / patterns (e.g., manifest-path)
_arguments \
  '(-v --verbose)'{-v,--verbose}'[Use verbose output]' \
  '(--release)'--release'[Build artifacts in release mode]' \
  '--package=[package]:package name' \
  '--manifest-path=[path]:path:_files' \
  '--features=[list]:features' \
  '--no-default-features[Disable default features]' \
  '*::arg:->rest'

case $state in
  rest)
    _files
    ;;
esac

return 0
